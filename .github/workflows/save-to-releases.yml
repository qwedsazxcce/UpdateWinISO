name: 下载OneDrive文件并上传到Releases

# 触发方式：手动触发（也可添加push等自动触发条件）
on:
  workflow_dispatch:

jobs:
  download-and-upload:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：检出仓库（上传Release需要仓库上下文）
      - name: 检出代码仓库
        uses: actions/checkout@v4

      # 步骤2：下载OneDrive文件（保持原文件名）
      - name: 从OneDrive下载文件
        run: |
          # OneDrive直链（追加了download=1参数）
          ONEDRIVE_URL="https://1drv.ms/f/c/371b320e0c098119/IgCD2fuOsRxbTbEn8gqDidsWAX8Sv8LVWJe8YdB4sQq2ZM8?e=XZTP8O&download=1"
          
          # 使用curl下载，自动保留原始文件名（-OJ参数）
          # -L：跟随重定向；-O：保留原文件名；-J：从响应头解析文件名；--retry：失败重试
          curl -L -O -J --retry 5 "$ONEDRIVE_URL"
          
          # 打印下载的文件列表，确认文件存在
          echo "已下载的文件："
          ls -l

      # 步骤3：上传文件到GitHub Releases
      - name: 上传到Releases
        uses: softprops/action-gh-release@v2
        with:
          # 指定Release名称（对应你的server_2022-2025项目）
          tag_name: server_2022-2025
          # 如果Release不存在则创建，存在则追加文件
          draft: false
          prerelease: false
          # 上传当前目录下的所有文件（保持原文件名）
          files: |
            ./*
        env:
          # 必要的GitHub令牌（Actions默认提供）
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
